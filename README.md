# ip_group

ip_group.py is a python script that creates or updates IP Groups in Cognito Detect via Detect's API from a CSV formatted
list.  The script now has better error handling and will attempt to catch any errors and print them out at the 
conclusion of the run.

## Prerequisites

Python3, requests, and Vectra API Tools (vat) modules.  
Required modules will be installed when following the setup procedure outlined.  

For Quadrant UX
- A Cognito Detect API token is required and can be generated by going to **My Profile** and Generating an API token. 

For Respond UX
- API Client ID and Secret Key is required and can be generated by going to **Manage -> API Clients** and adding an API Client

A CSV formatted file containing the group names, IP subnets, and descriptions to be created or updated.

## Setup
Manually clone or download using git, install requirements with pip3:
```
git clone https://github.com/vectranetworks/csv-to-ip-group.git
pip3 install -r requirements.txt
```


## CSV file format
The CSV file can include a CSV header row.  
The CSV file can contain either 3 or 4 columns of data, and can include a description.    

### 3-column format (subnet in CIDR notation) example:
```
group 1,10.1.1.0/24, group 1 description
group 1,10.1.2.0/24,
group 2,10.2.0.0/16, group 2 description
```
### 4-column format (subnet in netmask notation) example:
```
group 1,10.1.1.0,255.255.255.0, group 1 description
group 1,10.1.2.0,255.255.255.0,
group 2,10.2.0.0,255.255.0.0, group 2 description
```
## Notes
Subnets that have host bits set will automatically have the host bits removed.

Group names and description do not support the following characters which will automatically be replaced by the '_' 
character.

```'~', '#', '$', '^', '+', '=', '<', '>', '?', ';'```

An alternate substitution character can be specified with the **--sub_char** cli flag.

The script attempts to identify a supported character set encoding, defaults to unicode when unable to identify an 
encoding from a BOM.

## Running

When ran, the script needs to be supplied one or more parameters.  Example:


```
python3 ip_group.py --brain <brain IP/hostname> --token <cognito_token> subnet_data.csv -a
python3 ip_group.py --brain <brain IP/hostname> --client_id <client_id> --secret_key <secret_key> subnet_data.csv -a
```
 
The **-a** flag will force the script to use the CSV as the *plan of record* and update the groups in Cognito 
to match the contents of the CSV.  Without the **-a** flag the script will update existing groups only from the contents of the CSV.  
 
## Help Output
```
python3 ip_group.py -h
usage: ip_group.py [-h] [--brain BRAIN] [--token TOKEN] [--client_id CLIENT_ID] [--secret_key SECRET_KEY] [--file FILE] [-a] [-d] [--sub_char SUB_CHAR] [--verbose]

Supplied with name of CSV input file, creates or updates IP groups with supplied subnet information.  
CSV file format: group_name,subnet,description

Subnet can be supplied in CIDR notation e.g. 
group name,10.1.1.0/24,some description

or as subnet and netmask separate by a comma (,) e.g.
group name,10.1.1.1.0,255.255.255.0,some description

options:
  -h, --help            show this help message and exit
  --brain BRAIN         URL for the brain
  --token TOKEN         V2 API token to access Cognito Detect
  --client_id CLIENT_ID 
                        V3 API Client ID
  --secret_key SECRET_KEY 
                        V3 API Secret Key
  --file FILE           Name of csv input file
  -a, --authoritative   Data contained in CSV is authoritative.  Group information will be overwritten where necessary.
  -d, --dryrun          Do dry run, no updates to Cognito
  --sub_char SUB_CHAR   Override default invalid character substitution in group names and description.  Default is _
                        May not be one of the following characters
                        ['~', '#', '$', '^', '+', '=', '<', '>', '?', ';']
  --verbose             Verbose logging
 
```

## Authors

* **Matt Pieklik** - *Initial work*
* **Brandon Wyatt** - *V3 Support*

## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details
